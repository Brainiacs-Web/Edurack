<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Enable app-like experience on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="icon-192.png">
  <title>Settings - Edurack</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007adf" />
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Base Variables for Light Mode */
    :root {
      --primary-color: #007adf;
      --secondary-color: #0056b3;
      --accent-color: #ff6f61;
      --light-bg: #f4f7fb;
      --white: #fff;
      --text-color: #333;
      --text-secondary: #666;
      --card-shadow: 0 8px 24px rgba(149, 157, 165, 0.15);
      --hover-bg: rgba(0, 122, 223, 0.1);
      --modal-bg: rgba(0, 0, 0, 0.6);
      --border-color: #e0e0e0;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
      --transition-speed: 0.3s;
    }
    
    /* Dark Mode Variables */
    body.dark-mode {
      --primary-color: #4da6ff;
      --secondary-color: #1a75ff;
      --accent-color: #ff8a80;
      --light-bg: #121212;
      --white: #1e1e1e;
      --text-color: #e0e0e0;
      --text-secondary: #aaaaaa;
      --card-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      --hover-bg: rgba(77, 166, 255, 0.15);
      --modal-bg: rgba(0, 0, 0, 0.8);
      --border-color: #333333;
    }
    
    /* Global Resets & Typography */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }
    
    body {
      background: var(--light-bg);
      color: var(--text-color);
      line-height: 1.6;
      transition: background var(--transition-speed) ease, color var(--transition-speed) ease;
      overflow-x: hidden;
    }
    
    a {
      text-decoration: none;
      color: var(--primary-color);
      transition: color var(--transition-speed) ease;
    }
    
    a:hover {
      color: var(--secondary-color);
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.3;
    }
    
    /* Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
      background: var(--white);
      box-shadow: var(--card-shadow);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 300;
      border-bottom: 1px solid var(--border-color);
      transition: background var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
    }
    
    .navbar-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .mobile-menu-toggle {
      display: none;
      font-size: 22px;
      border: none;
      background: none;
      cursor: pointer;
      color: var(--text-color);
      transition: color var(--transition-speed) ease;
      padding: 8px;
      border-radius: 8px;
    }
    
    .mobile-menu-toggle:hover {
      color: var(--primary-color);
      background: var(--hover-bg);
    }
    
    .logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition-speed) ease;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }
    
    .logo i {
      font-size: 28px;
    }
    
    .nav-right {
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
    }
    
    /* Search Wrapper */
    .search-wrapper {
      position: relative;
    }
    
    .search-input {
      padding: 10px 16px 10px 40px;
      border: 1px solid var(--border-color);
      border-radius: 50px;
      font-size: 0.95rem;
      width: 240px;
      background: var(--light-bg);
      color: var(--text-color);
      transition: all var(--transition-speed) ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 223, 0.2);
      width: 280px;
    }
    
    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 16px;
      pointer-events: none;
    }
    
    .search-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 20px;
      color: var(--text-color);
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background var(--transition-speed) ease;
    }
    
    .search-toggle:hover {
      background: var(--hover-bg);
    }
    
    /* Dark Mode Toggle */
    .dark-toggle {
      font-size: 20px;
      cursor: pointer;
      border: none;
      background: var(--hover-bg);
      color: var(--text-color);
      transition: all var(--transition-speed) ease;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .dark-toggle:hover {
      color: var(--primary-color);
      transform: rotate(15deg);
    }
    
    /* Profile */
    .profile {
      display: flex;
      align-items: center;
      cursor: pointer;
      position: relative;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 50px;
      transition: background var(--transition-speed) ease;
    }
    
    .profile:hover {
      background: var(--hover-bg);
    }
    
    .navbar-profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary-color);
      transition: transform var(--transition-speed) ease;
    }
    
    .profile:hover .navbar-profile-pic {
      transform: scale(1.05);
    }
    
    .profile-info {
      display: none;
    }
    
    .profile-dropdown {
      position: absolute;
      top: 60px;
      right: 0;
      background: var(--white);
      border: 1px solid var(--border-color);
      box-shadow: var(--card-shadow);
      border-radius: 12px;
      padding: 16px;
      display: none;
      z-index: 400;
      min-width: 220px;
      animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .profile-dropdown p {
      font-weight: 500;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
    }
    
    .profile-dropdown a {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      color: var(--text-color);
      font-size: 0.95rem;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: all var(--transition-speed) ease;
    }
    
    .profile-dropdown a:hover {
      background: var(--hover-bg);
      color: var(--primary-color);
      transform: translateX(4px);
    }
    
    .profile-dropdown a i {
      margin-right: 12px;
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 70px;
      left: 0;
      width: 260px;
      height: calc(100% - 70px);
      background: var(--white);
      box-shadow: var(--card-shadow);
      padding: 24px 16px;
      overflow-y: auto;
      z-index: 200;
      transition: all var(--transition-speed) ease;
      border-right: 1px solid var(--border-color);
    }
    
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }
    
    .sidebar::-webkit-scrollbar-thumb {
      background-color: var(--border-color);
      border-radius: 10px;
    }
    
    .sidebar ul {
      list-style: none;
    }
    
    .sidebar ul li {
      margin-bottom: 8px;
    }
    
    .sidebar ul li a {
      color: var(--text-color);
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      transition: all var(--transition-speed) ease;
      font-weight: 500;
    }
    
    .sidebar ul li a i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    .sidebar ul li a:hover {
      background: var(--hover-bg);
      color: var(--primary-color);
      transform: translateX(4px);
    }
    
    .sidebar ul li a.active {
      background: var(--primary-color);
      color: white;
    }
    
    .sidebar ul li a.active:hover {
      transform: none;
    }
    
    .sidebar-footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      margin: 90px 30px 30px 290px;
      transition: margin var(--transition-speed) ease;
    }
    
    .page-header {
      margin-bottom: 40px;
      background: var(--white);
      padding: 30px;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
    }
    
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: var(--primary-color);
      opacity: 0.1;
      border-radius: 50%;
      transform: translate(50%, -50%);
    }
    
    .page-header h1 {
      font-size: 2.2rem;
      margin-bottom: 16px;
      color: var(--primary-color);
      position: relative;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .page-header h1 i {
      font-size: 2rem;
    }
    
    .page-header p {
      font-size: 1.1rem;
      color: var(--text-secondary);
      line-height: 1.7;
      position: relative;
    }
    
    /* Settings Navigation */
    .settings-nav {
      background: var(--white);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 24px;
      margin-bottom: 30px;
    }
    
    .settings-nav-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .settings-nav-item {
      padding: 12px 20px;
      border-radius: 50px;
      background: var(--light-bg);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .settings-nav-item:hover {
      background: var(--hover-bg);
      color: var(--primary-color);
    }
    
    .settings-nav-item.active {
      background: var(--primary-color);
      color: white;
    }
    
    .settings-nav-item i {
      font-size: 16px;
    }
    
    /* Settings Sections */
    .settings-section {
      background: var(--white);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 30px;
      margin-bottom: 30px;
      display: none;
    }
    
    .settings-section.active {
      display: block;
      animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .settings-section h2 {
      font-size: 1.5rem;
      margin-bottom: 24px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .settings-section h2 i {
      color: var(--primary-color);
      font-size: 24px;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--light-bg);
      color: var(--text-color);
      transition: all var(--transition-speed) ease;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 223, 0.2);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .form-help {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* Profile Picture Upload */
    .profile-upload {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .profile-upload-pic {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary-color);
    }
    
    .profile-upload-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .file-input {
      display: none;
    }
    
    .file-input-label {
      padding: 10px 20px;
      background: var(--primary-color);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    
    .file-input-label:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }
    
    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border-color);
      transition: var(--transition-speed);
      border-radius: 34px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: var(--transition-speed);
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--primary-color);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .setting-item:last-child {
      border-bottom: none;
    }
    
    .setting-info h4 {
      font-size: 1.1rem;
      margin-bottom: 4px;
      color: var(--text-color);
    }
    
    .setting-info p {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 1rem;
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: none;
      text-decoration: none;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 122, 223, 0.2);
    }
    
    .btn-secondary {
      background: var(--light-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    /* Security Section */
    .security-item {
      background: var(--light-bg);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
      border-left: 4px solid var(--primary-color);
    }
    
    .security-item h4 {
      color: var(--text-color);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .security-item p {
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    
    .security-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .security-status.enabled {
      background: rgba(76, 175, 80, 0.1);
      color: var(--success-color);
    }
    
    .security-status.disabled {
      background: rgba(244, 67, 54, 0.1);
      color: var(--danger-color);
    }
    
    /* Danger Zone */
    .danger-zone {
      background: rgba(244, 67, 54, 0.05);
      border: 1px solid rgba(244, 67, 54, 0.2);
      border-radius: 12px;
      padding: 24px;
      margin-top: 30px;
    }
    
    .danger-zone h3 {
      color: var(--danger-color);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .danger-zone p {
      color: var(--text-secondary);
      margin-bottom: 20px;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 500;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: var(--white);
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      transform: scale(0.9);
      transition: transform var(--transition-speed) ease;
    }
    
    .modal-overlay.active .modal {
      transform: scale(1);
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .modal-icon {
      font-size: 32px;
      color: var(--primary-color);
    }
    
    .modal h3 {
      font-size: 1.4rem;
      color: var(--text-color);
    }
    
    .modal p {
      color: var(--text-secondary);
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    
    /* Success Message */
    .success-message {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid rgba(76, 175, 80, 0.3);
      color: var(--success-color);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      align-items: center;
      gap: 8px;
    }
    
    .success-message.show {
      display: flex;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Responsive Styles */
    @media (min-width: 992px) {
      .profile-info {
        display: block;
        margin-right: 8px;
      }
      
      .profile-info span {
        display: block;
        line-height: 1.2;
      }
      
      .profile-info span:first-child {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-color);
      }
      
      .profile-info span:last-child {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }
    }
    
    @media (max-width: 1200px) {
      .sidebar {
        width: 240px;
      }
      
      .main-content {
        margin-left: 270px;
      }
    }
    
    @media (max-width: 992px) {
      .search-input {
        width: 180px;
      }
      
      .search-input:focus {
        width: 220px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .sidebar {
        width: 280px;
        left: -300px;
        z-index: 350;
      }
      
      .sidebar.active {
        left: 0;
      }
      
      .main-content {
        margin: 80px 20px 20px 20px;
      }
      
      .mobile-menu-toggle {
        display: block;
      }
      
      .search-input {
        display: none;
      }
      
      .search-toggle {
        display: inline-block;
      }
      
      .settings-nav-list {
        flex-direction: column;
      }
      
      .settings-nav-item {
        justify-content: center;
      }
      
      .profile-upload {
        flex-direction: column;
        text-align: center;
      }
      
      .btn-group {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      .navbar {
        padding: 12px 16px;
      }
      
      .logo {
        font-size: 20px;
      }
      
      .nav-right {
        gap: 12px;
      }
      
      .page-header h1 {
        font-size: 1.8rem;
      }
      
      .page-header p {
        font-size: 1rem;
      }
    }
    
    /* Overlay for sidebar on mobile */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
    }
    
    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-left">
      <button class="mobile-menu-toggle" id="mobileMenuToggle" title="Toggle Navigation" aria-label="Toggle Navigation">
        <i class="fas fa-bars"></i>
      </button>
      <div class="logo">
        <i class="fas fa-graduation-cap"></i>
        Edurack
      </div>
    </div>
    <div class="nav-right">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" placeholder="Search settings..." class="search-input" aria-label="Search settings">
        <button id="searchToggle" class="search-toggle" title="Search" aria-label="Toggle Search">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <button id="darkToggle" class="dark-toggle" title="Toggle Dark Mode" aria-label="Toggle Dark Mode">
        <i class="fas fa-moon"></i>
      </button>
      <!-- Profile Icon with Image -->
      <div class="profile">
        <div class="profile-info">
          <span id="profileName">User</span>
          <span>Student</span>
        </div>
        <img id="navbarProfilePic" src="default-profile.png" alt="Profile" class="navbar-profile-pic" loading="lazy">
        <div class="profile-dropdown" id="profileDropdown">
          <p id="profileGreeting">Hi, User!</p>
          <a href="profile.html"><i class="fas fa-user"></i> My Profile</a>
          <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
          <a href="help.html"><i class="fas fa-question-circle"></i> Help Center</a>
          <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Log Out</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Search -->
  <div class="search-mobile" id="searchMobile">
    <input type="text" placeholder="Search settings..." aria-label="Mobile search">
  </div>

  <!-- Sidebar Overlay (Mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <ul>
      <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="pyqs.html"><i class="fas fa-question-circle"></i> PYQs</a></li>
      <li><a href="test-series.html"><i class="fas fa-pen-square"></i> Test Series</a></li>
      <li><a href="chapter-growth.html"><i class="fas fa-chart-line"></i> Chapter Growth</a></li>
      <li><a href="leaderboard.html"><i class="fas fa-trophy"></i> Leaderboard</a></li>
      <li><a href="courses.html"><i class="fas fa-book"></i> Courses</a></li>
      <li><a href="schedule.html"><i class="fas fa-calendar-alt"></i> Schedule</a></li>
      <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
      <li><a href="settings.html" class="active"><i class="fas fa-cog"></i> Settings</a></li>
      <li><a href="contact.html"><i class="fas fa-envelope"></i> Contact</a></li>
    </ul>
    <div class="sidebar-footer">
      <p>Edurack v2.0</p>
      <p>© 2025 All Rights Reserved</p>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Page Header -->
    <section class="page-header">
      <h1><i class="fas fa-cog"></i> Settings</h1>
      <p>Manage your account preferences, privacy settings, and customize your learning experience.</p>
    </section>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
      <i class="fas fa-check-circle"></i>
      <span>Settings saved successfully!</span>
    </div>

    <!-- Settings Navigation -->
    <div class="settings-nav">
      <div class="settings-nav-list">
        <div class="settings-nav-item active" data-section="profile">
          <i class="fas fa-user"></i> Profile
        </div>
        <div class="settings-nav-item" data-section="account">
          <i class="fas fa-user-cog"></i> Account
        </div>
        <div class="settings-nav-item" data-section="notifications">
          <i class="fas fa-bell"></i> Notifications
        </div>
        <div class="settings-nav-item" data-section="privacy">
          <i class="fas fa-shield-alt"></i> Privacy
        </div>
        <div class="settings-nav-item" data-section="security">
          <i class="fas fa-lock"></i> Security
        </div>
        <div class="settings-nav-item" data-section="preferences">
          <i class="fas fa-palette"></i> Preferences
        </div>
      </div>
    </div>

    <!-- Profile Settings -->
    <section class="settings-section active" id="profile-section">
      <h2><i class="fas fa-user"></i> Profile Information</h2>
      
      <div class="profile-upload">
        <img id="profilePicture" src="https://ui-avatars.com/api/?name=User&background=007adf&color=fff" alt="Profile Picture" class="profile-upload-pic">
        <div class="profile-upload-actions">
          <label for="profilePicInput" class="file-input-label">
            <i class="fas fa-camera"></i> Change Photo
          </label>
          <input type="file" id="profilePicInput" class="file-input" accept="image/*">
          <button class="btn btn-secondary" id="removePhoto">
            <i class="fas fa-trash"></i> Remove
          </button>
        </div>
      </div>

      <form id="profileForm">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" name="firstName" value="John" required>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" name="lastName" value="Doe" required>
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" value="john.doe@example.com" required>
          <div class="form-help">We'll send important updates to this email address.</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" value="+1 (555) 123-4567">
          </div>
          <div class="form-group">
            <label for="dateOfBirth">Date of Birth</label>
            <input type="date" id="dateOfBirth" name="dateOfBirth" value="2000-01-01">
          </div>
        </div>

        <div class="form-group">
          <label for="bio">Bio</label>
          <textarea id="bio" name="bio" placeholder="Tell us about yourself...">Passionate NEET aspirant focused on achieving my medical dreams.</textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="school">School/College</label>
            <input type="text" id="school" name="school" value="Delhi Public School">
          </div>
          <div class="form-group">
            <label for="examTarget">Target Exam</label>
            <select id="examTarget" name="examTarget">
              <option value="neet">NEET</option>
              <option value="jee-main">JEE Main</option>
              <option value="jee-advanced">JEE Advanced</option>
              <option value="both">NEET & JEE</option>
            </select>
          </div>
        </div>

        <div class="btn-group">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Changes
          </button>
          <button type="button" class="btn btn-secondary" id="cancelProfile">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </form>
    </section>

    <!-- Account Settings -->
    <section class="settings-section" id="account-section">
      <h2><i class="fas fa-user-cog"></i> Account Settings</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Account Status</h4>
          <p>Your account is currently active and verified</p>
        </div>
        <div class="security-status enabled">
          <i class="fas fa-check-circle"></i> Active
        </div>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Email Verification</h4>
          <p>Verify your email to secure your account</p>
        </div>
        <div class="security-status enabled">
          <i class="fas fa-check-circle"></i> Verified
        </div>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Phone Verification</h4>
          <p>Add an extra layer of security to your account</p>
        </div>
        <button class="btn btn-primary">
          <i class="fas fa-mobile-alt"></i> Verify Phone
        </button>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Account Type</h4>
          <p>Upgrade to premium for advanced features</p>
        </div>
        <button class="btn btn-primary">
          <i class="fas fa-crown"></i> Upgrade to Premium
        </button>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Data Export</h4>
          <p>Download a copy of your data</p>
        </div>
        <button class="btn btn-secondary">
          <i class="fas fa-download"></i> Export Data
        </button>
      </div>
    </section>

    <!-- Notification Settings -->
    <section class="settings-section" id="notifications-section">
      <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Email Notifications</h4>
          <p>Receive updates and announcements via email</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Test Reminders</h4>
          <p>Get notified about upcoming tests and deadlines</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Study Streak Alerts</h4>
          <p>Motivational notifications to maintain your study streak</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Leaderboard Updates</h4>
          <p>Get notified when your ranking changes</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>New Content Alerts</h4>
          <p>Be the first to know about new questions and materials</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Marketing Communications</h4>
          <p>Receive promotional emails and special offers</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </section>

    <!-- Privacy Settings -->
    <section class="settings-section" id="privacy-section">
      <h2><i class="fas fa-shield-alt"></i> Privacy Settings</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Profile Visibility</h4>
          <p>Control who can see your profile information</p>
        </div>
        <select style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color);">
          <option value="public">Public</option>
          <option value="friends">Friends Only</option>
          <option value="private">Private</option>
        </select>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Show in Leaderboard</h4>
          <p>Display your name and rank in public leaderboards</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Activity Status</h4>
          <p>Show when you're online and active</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Study Analytics</h4>
          <p>Allow us to analyze your study patterns for better recommendations</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Data Sharing</h4>
          <p>Share anonymized data to help improve our platform</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </section>

    <!-- Security Settings -->
    <section class="settings-section" id="security-section">
      <h2><i class="fas fa-lock"></i> Security Settings</h2>
      
      <div class="security-item">
        <h4><i class="fas fa-key"></i> Password</h4>
        <p>Last changed 30 days ago</p>
        <div class="security-status enabled">
          <i class="fas fa-check-circle"></i> Strong
        </div>
        <button class="btn btn-primary" style="margin-top: 12px;" id="changePasswordBtn">
          <i class="fas fa-edit"></i> Change Password
        </button>
      </div>

      <div class="security-item">
        <h4><i class="fas fa-mobile-alt"></i> Two-Factor Authentication</h4>
        <p>Add an extra layer of security to your account</p>
        <div class="security-status disabled">
          <i class="fas fa-times-circle"></i> Disabled
        </div>
        <button class="btn btn-primary" style="margin-top: 12px;">
          <i class="fas fa-shield-alt"></i> Enable 2FA
        </button>
      </div>

      <div class="security-item">
        <h4><i class="fas fa-devices"></i> Active Sessions</h4>
        <p>Manage devices that are currently signed in</p>
        <button class="btn btn-secondary" style="margin-top: 12px;">
          <i class="fas fa-eye"></i> View Sessions
        </button>
      </div>

      <div class="security-item">
        <h4><i class="fas fa-history"></i> Login History</h4>
        <p>Review recent login activity</p>
        <button class="btn btn-secondary" style="margin-top: 12px;">
          <i class="fas fa-list"></i> View History
        </button>
      </div>
    </section>

    <!-- Preferences Settings -->
    <section class="settings-section" id="preferences-section">
      <h2><i class="fas fa-palette"></i> Preferences</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Theme</h4>
          <p>Choose your preferred color scheme</p>
        </div>
        <select id="themeSelect" style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color);">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="auto">Auto (System)</option>
        </select>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Language</h4>
          <p>Select your preferred language</p>
        </div>
        <select style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color);">
          <option value="en">English</option>
          <option value="hi">Hindi</option>
          <option value="bn">Bengali</option>
          <option value="ta">Tamil</option>
          <option value="te">Telugu</option>
        </select>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Time Zone</h4>
          <p>Set your local time zone for accurate scheduling</p>
        </div>
        <select style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color);">
          <option value="Asia/Kolkata">India Standard Time (IST)</option>
          <option value="America/New_York">Eastern Time (ET)</option>
          <option value="Europe/London">Greenwich Mean Time (GMT)</option>
          <option value="Asia/Tokyo">Japan Standard Time (JST)</option>
        </select>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Auto-save Progress</h4>
          <p>Automatically save your progress while studying</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Sound Effects</h4>
          <p>Play sounds for correct/incorrect answers</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h4>Animations</h4>
          <p>Enable smooth animations and transitions</p>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone">
        <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
        <p>These actions are irreversible. Please proceed with caution.</p>
        
        <div class="setting-item" style="border: none; padding: 16px 0;">
          <div class="setting-info">
            <h4>Deactivate Account</h4>
            <p>Temporarily disable your account. You can reactivate it anytime.</p>
          </div>
          <button class="btn btn-secondary">
            <i class="fas fa-pause"></i> Deactivate
          </button>
        </div>

        <div class="setting-item" style="border: none; padding: 16px 0;">
          <div class="setting-info">
            <h4>Delete Account</h4>
            <p>Permanently delete your account and all associated data.</p>
          </div>
          <button class="btn btn-danger" id="deleteAccountBtn">
            <i class="fas fa-trash"></i> Delete Account
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Change Password Modal -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-icon">
          <i class="fas fa-key"></i>
        </div>
        <h3>Change Password</h3>
      </div>
      <form id="passwordForm">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input type="password" id="currentPassword" name="currentPassword" required>
        </div>
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" name="newPassword" required>
          <div class="form-help">Password must be at least 8 characters long</div>
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input type="password" id="confirmPassword" name="confirmPassword" required>
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn btn-secondary" id="cancelPassword">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Update Password
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-icon" style="color: var(--danger-color);">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3>Delete Account</h3>
      </div>
      <p>Are you absolutely sure you want to delete your account? This action cannot be undone and will permanently remove all your data, including:</p>
      <ul style="margin: 16px 0; padding-left: 20px; color: var(--text-secondary);">
        <li>Your profile and personal information</li>
        <li>All test scores and progress</li>
        <li>Study history and analytics</li>
        <li>Saved questions and bookmarks</li>
      </ul>
      <div class="form-group">
        <label for="deleteConfirmation">Type "DELETE" to confirm:</label>
        <input type="text" id="deleteConfirmation" placeholder="DELETE" style="margin-top: 8px;">
      </div>
      <div class="modal-buttons">
        <button type="button" class="btn btn-secondary" id="cancelDelete">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDelete" disabled>
          <i class="fas fa-trash"></i> Delete Account
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script>
// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDFAzyQGNmOD6bmLnZH9evfL3V-PS4cajA",
  authDomain: "arena-b8996.firebaseapp.com",
  projectId: "arena-b8996",
  storageBucket: "arena-b8996.firebasestorage.app",
  messagingSenderId: "188106766480",
  appId: "1:188106766480:web:801e701f00151448090015"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

// Initialize services
const auth = firebase.auth();
const firestore = firebase.firestore();
const storage = firebase.storage();

// Cache DOM elements
const profileNameEl = document.getElementById("profileName");
const profileGreetingEl = document.getElementById("profileGreeting");
const navbarProfilePic = document.getElementById("navbarProfilePic");
const profilePicture = document.getElementById("profilePicture");
const sidebar = document.getElementById("sidebar");
const sidebarOverlay = document.getElementById("sidebarOverlay");
const mobileMenuToggle = document.getElementById("mobileMenuToggle");
const searchToggle = document.getElementById("searchToggle");
const searchMobile = document.getElementById("searchMobile");
const darkToggle = document.getElementById("darkToggle");
const profileEl = document.querySelector(".profile");
const profileDropdownEl = document.getElementById("profileDropdown");
const logoutBtn = document.getElementById("logoutBtn");
const successMessage = document.getElementById("successMessage");

// Settings navigation
const settingsNavItems = document.querySelectorAll('.settings-nav-item');
const settingsSections = document.querySelectorAll('.settings-section');

// Modals
const passwordModal = document.getElementById("passwordModal");
const deleteModal = document.getElementById("deleteModal");
const changePasswordBtn = document.getElementById("changePasswordBtn");
const deleteAccountBtn = document.getElementById("deleteAccountBtn");
const cancelPassword = document.getElementById("cancelPassword");
const cancelDelete = document.getElementById("cancelDelete");
const deleteConfirmation = document.getElementById("deleteConfirmation");
const confirmDelete = document.getElementById("confirmDelete");

// Forms
const profileForm = document.getElementById("profileForm");
const passwordForm = document.getElementById("passwordForm");
const profilePicInput = document.getElementById("profilePicInput");
const removePhoto = document.getElementById("removePhoto");
const themeSelect = document.getElementById("themeSelect");
const cancelProfile = document.getElementById("cancelProfile");

// Global user data
let currentUserData = {};

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
  initializeTheme();
  setupEventListeners();
  loadUserSettings();
});

// Theme Management
function initializeTheme() {
  const savedTheme = localStorage.getItem('edurack_theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  
  if (savedTheme === 'dark' || (savedTheme === 'auto' && prefersDark) || (!savedTheme && prefersDark)) {
    document.body.classList.add('dark-mode');
    darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
    themeSelect.value = savedTheme || 'auto';
  } else {
    document.body.classList.remove('dark-mode');
    darkToggle.innerHTML = '<i class="fas fa-moon"></i>';
    themeSelect.value = savedTheme || 'light';
  }
}

function setTheme(theme) {
  localStorage.setItem('edurack_theme', theme);
  
  if (theme === 'dark') {
    document.body.classList.add('dark-mode');
    darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else if (theme === 'light') {
    document.body.classList.remove('dark-mode');
    darkToggle.innerHTML = '<i class="fas fa-moon"></i>';
  } else {
    // Auto theme
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (prefersDark) {
      document.body.classList.add('dark-mode');
      darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
      document.body.classList.remove('dark-mode');
      darkToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
  }
  
  showSuccessMessage('Theme updated successfully!');
}

// Event Listeners Setup
function setupEventListeners() {
  // Mobile menu toggle
  mobileMenuToggle.addEventListener("click", toggleMobileMenu);
  sidebarOverlay.addEventListener("click", closeMobileMenu);
  
  // Search toggle
  searchToggle.addEventListener("click", toggleMobileSearch);
  document.addEventListener("click", closeMobileSearchOutside);
  
  // Profile dropdown
  profileEl.addEventListener("click", toggleProfileDropdown);
  document.addEventListener("click", closeProfileDropdownOutside);
  
  // Theme controls
  darkToggle.addEventListener("click", toggleDarkMode);
  themeSelect.addEventListener('change', handleThemeChange);
  
  // Settings navigation
  settingsNavItems.forEach(item => {
    item.addEventListener('click', () => switchSettingsSection(item.dataset.section));
  });
  
  // Forms
  profileForm.addEventListener('submit', handleProfileSubmit);
  passwordForm.addEventListener('submit', handlePasswordSubmit);
  cancelProfile.addEventListener('click', resetProfileForm);
  
  // Profile picture
  profilePicInput.addEventListener('change', handleProfilePictureUpload);
  removePhoto.addEventListener('click', handleRemoveProfilePicture);
  
  // Modals
  changePasswordBtn.addEventListener('click', () => openModal(passwordModal));
  deleteAccountBtn.addEventListener('click', () => openModal(deleteModal));
  cancelPassword.addEventListener('click', () => closeModal(passwordModal));
  cancelDelete.addEventListener('click', () => closeModal(deleteModal));
  
  // Delete account confirmation
  deleteConfirmation.addEventListener('input', handleDeleteConfirmation);
  confirmDelete.addEventListener('click', handleDeleteAccount);
  
  // Close modals on outside click
  [passwordModal, deleteModal].forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal(modal);
    });
  });
  
  // Toggle switches
  setupToggleSwitches();
  
  // Select dropdowns
  setupSelectDropdowns();
  
  // Logout
  logoutBtn.addEventListener("click", handleLogout);
  
  // System theme change detection
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (localStorage.getItem('edurack_theme') === 'auto') {
      setTheme('auto');
    }
  });
}

// Mobile Menu Functions
function toggleMobileMenu(e) {
  e.stopPropagation();
  sidebar.classList.toggle("active");
  sidebarOverlay.classList.toggle("active");
  document.body.style.overflow = sidebar.classList.contains("active") ? "hidden" : "";
}

function closeMobileMenu() {
  sidebar.classList.remove("active");
  sidebarOverlay.classList.remove("active");
  document.body.style.overflow = "";
}

// Mobile Search Functions
function toggleMobileSearch() {
  searchMobile.classList.toggle("active");
  if (searchMobile.classList.contains("active")) {
    searchMobile.querySelector("input").focus();
  }
}

function closeMobileSearchOutside(e) {
  if (!searchToggle.contains(e.target) && !searchMobile.contains(e.target)) {
    searchMobile.classList.remove("active");
  }
}

// Profile Dropdown Functions
function toggleProfileDropdown(e) {
  e.stopPropagation();
  profileDropdownEl.style.display = profileDropdownEl.style.display === "block" ? "none" : "block";
}

function closeProfileDropdownOutside() {
  profileDropdownEl.style.display = "none";
}

// Theme Functions
function toggleDarkMode() {
  const currentTheme = localStorage.getItem('edurack_theme') || 'light';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  setTheme(newTheme);
  themeSelect.value = newTheme;
}

function handleThemeChange(e) {
  setTheme(e.target.value);
}

// Settings Navigation
function switchSettingsSection(sectionName) {
  // Update active nav item
  settingsNavItems.forEach(nav => nav.classList.remove('active'));
  document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
  
  // Show target section
  settingsSections.forEach(section => {
    section.classList.remove('active');
    if (section.id === sectionName + '-section') {
      section.classList.add('active');
    }
  });
  
  // Save current section
  localStorage.setItem('edurack_current_settings_section', sectionName);
}

// Firebase Auth State Management
auth.onAuthStateChanged(async (user) => {
  if (user) {
    await loadUserData(user);
    loadSavedSettingsSection();
  } else {
    window.location.href = "index.html";
  }
});

// Load User Data
async function loadUserData(user) {
  try {
    const doc = await firestore.collection("users").doc(user.uid).get();
    
    if (doc.exists) {
      currentUserData = { id: user.uid, ...doc.data() };
      updateUIWithUserData(currentUserData);
    } else {
      // Create user document if it doesn't exist
      currentUserData = {
        id: user.uid,
        fullName: user.displayName || "User",
        email: user.email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      await firestore.collection("users").doc(user.uid).set(currentUserData);
      updateUIWithUserData(currentUserData);
    }
  } catch (error) {
    console.error("Error loading user data:", error);
    showErrorMessage("Error loading user data. Please refresh the page.");
  }
}

// Update UI with User Data
function updateUIWithUserData(userData) {
  const name = userData.fullName || "User";
  const email = userData.email || "";
  
  // Update navbar
  profileNameEl.innerText = name;
  profileGreetingEl.innerText = `Hi, ${name}!`;
  
  // Update profile pictures
  if (userData.photoURL) {
    navbarProfilePic.src = userData.photoURL;
    profilePicture.src = userData.photoURL;
  } else {
    const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(initials)}&background=007adf&color=fff&size=200`;
    navbarProfilePic.src = avatarUrl;
    profilePicture.src = avatarUrl;
  }
  
  // Update form fields
  const nameParts = name.split(' ');
  document.getElementById('firstName').value = nameParts[0] || '';
  document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
  document.getElementById('email').value = email;
  document.getElementById('phone').value = userData.phone || '';
  document.getElementById('dateOfBirth').value = userData.dateOfBirth || '';
  document.getElementById('bio').value = userData.bio || '';
  document.getElementById('school').value = userData.school || '';
  document.getElementById('examTarget').value = userData.examTarget || 'neet';
}

// Load Saved Settings Section
function loadSavedSettingsSection() {
  const savedSection = localStorage.getItem('edurack_current_settings_section') || 'profile';
  switchSettingsSection(savedSection);
}

// Profile Form Handling
async function handleProfileSubmit(e) {
  e.preventDefault();
  
  const submitBtn = profileForm.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  try {
    // Show loading state
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    submitBtn.disabled = true;
    
    const formData = new FormData(profileForm);
    const profileData = {
      fullName: `${formData.get('firstName')} ${formData.get('lastName')}`.trim(),
      email: formData.get('email'),
      phone: formData.get('phone'),
      dateOfBirth: formData.get('dateOfBirth'),
      bio: formData.get('bio'),
      school: formData.get('school'),
      examTarget: formData.get('examTarget'),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    // Validate required fields
    if (!profileData.fullName.trim()) {
      throw new Error('Full name is required');
    }
    
    if (!profileData.email.trim()) {
      throw new Error('Email is required');
    }
    
    // Update Firestore
    await firestore.collection('users').doc(currentUserData.id).update(profileData);
    
    // Update current user data
    currentUserData = { ...currentUserData, ...profileData };
    
    // Update UI
    profileNameEl.innerText = profileData.fullName;
    profileGreetingEl.innerText = `Hi, ${profileData.fullName}!`;
    
    showSuccessMessage('Profile updated successfully!');
    
  } catch (error) {
    console.error('Error updating profile:', error);
    showErrorMessage(error.message || 'Error updating profile. Please try again.');
  } finally {
    // Reset button state
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

// Reset Profile Form
function resetProfileForm() {
  updateUIWithUserData(currentUserData);
  showSuccessMessage('Changes discarded');
}

// Profile Picture Upload
async function handleProfilePictureUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  try {
    // Validate file
    if (!file.type.startsWith('image/')) {
      throw new Error('Please select an image file');
    }
    
    if (file.size > 5 * 1024 * 1024) {
      throw new Error('Image size should be less than 5MB');
    }
    
    // Show loading state
    const loadingOverlay = createLoadingOverlay('Uploading image...');
    document.body.appendChild(loadingOverlay);
    
    // Create storage reference
    const storageRef = storage.ref();
    const imageRef = storageRef.child(`profile-pictures/${currentUserData.id}/${Date.now()}_${file.name}`);
    
    // Upload file
    const snapshot = await imageRef.put(file);
    const downloadURL = await snapshot.ref.getDownloadURL();
    
    // Update Firestore
    await firestore.collection('users').doc(currentUserData.id).update({
      photoURL: downloadURL,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    // Update UI
    navbarProfilePic.src = downloadURL;
    profilePicture.src = downloadURL;
    currentUserData.photoURL = downloadURL;
    
    showSuccessMessage('Profile picture updated successfully!');
    
  } catch (error) {
    console.error('Error uploading profile picture:', error);
    showErrorMessage(error.message || 'Error uploading image. Please try again.');
  } finally {
    // Remove loading overlay
    const loadingOverlay = document.querySelector('.loading-overlay');
    if (loadingOverlay) {
      loadingOverlay.remove();
    }
    
    // Reset file input
    profilePicInput.value = '';
  }
}

// Remove Profile Picture
async function handleRemoveProfilePicture() {
  try {
    // Show loading state
    const loadingOverlay = createLoadingOverlay('Removing image...');
    document.body.appendChild(loadingOverlay);
    
    // Update Firestore
    await firestore.collection('users').doc(currentUserData.id).update({
      photoURL: firebase.firestore.FieldValue.delete(),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    // Generate new avatar
    const name = currentUserData.fullName || 'User';
    const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(initials)}&background=007adf&color=fff&size=200`;
    
    // Update UI
    navbarProfilePic.src = avatarUrl;
    profilePicture.src = avatarUrl;
    delete currentUserData.photoURL;
    
    showSuccessMessage('Profile picture removed successfully!');
    
  } catch (error) {
    console.error('Error removing profile picture:', error);
    showErrorMessage('Error removing image. Please try again.');
  } finally {
    // Remove loading overlay
    const loadingOverlay = document.querySelector('.loading-overlay');
    if (loadingOverlay) {
      loadingOverlay.remove();
    }
  }
}

// Password Change Handling
async function handlePasswordSubmit(e) {
  e.preventDefault();
  
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  
  const submitBtn = passwordForm.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  try {
    // Validate passwords
    if (newPassword !== confirmPassword) {
      throw new Error('New passwords do not match');
    }
    
    if (newPassword.length < 8) {
      throw new Error('Password must be at least 8 characters long');
    }
    
    if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(newPassword)) {
      throw new Error('Password must contain at least one uppercase letter, one lowercase letter, and one number');
    }
    
    // Show loading state
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
    submitBtn.disabled = true;
    
    const user = auth.currentUser;
    if (!user) throw new Error('User not authenticated');
    
    // Re-authenticate user
    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
    await user.reauthenticateWithCredential(credential);
    
    // Update password
    await user.updatePassword(newPassword);
    
    // Update last password change in Firestore
    await firestore.collection('users').doc(currentUserData.id).update({
      lastPasswordChange: firebase.firestore.FieldValue.serverTimestamp(),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    closeModal(passwordModal);
    passwordForm.reset();
    showSuccessMessage('Password updated successfully!');
    
  } catch (error) {
    console.error('Error updating password:', error);
    let errorMessage = 'Error updating password. Please try again.';
    
    if (error.code === 'auth/wrong-password') {
      errorMessage = 'Current password is incorrect';
    } else if (error.code === 'auth/weak-password') {
      errorMessage = 'Password is too weak';
    } else if (error.message) {
      errorMessage = error.message;
    }
    
    showErrorMessage(errorMessage);
  } finally {
    // Reset button state
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

// Delete Account Handling
function handleDeleteConfirmation(e) {
  confirmDelete.disabled = e.target.value !== 'DELETE';
  
  if (e.target.value === 'DELETE') {
    confirmDelete.style.background = 'var(--danger-color)';
    confirmDelete.style.transform = 'scale(1.02)';
  } else {
    confirmDelete.style.background = '';
    confirmDelete.style.transform = '';
  }
}

async function handleDeleteAccount() {
  const submitBtn = confirmDelete;
  const originalText = submitBtn.innerHTML;
  
  try {
    // Show loading state
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
    submitBtn.disabled = true;
    
    const user = auth.currentUser;
    if (!user) throw new Error('User not authenticated');
    
    // Delete user data from Firestore
    await firestore.collection('users').doc(currentUserData.id).delete();
    
    // Delete profile picture from storage if exists
    if (currentUserData.photoURL) {
      try {
        const photoRef = storage.refFromURL(currentUserData.photoURL);
        await photoRef.delete();
      } catch (error) {
        console.warn('Error deleting profile picture:', error);
      }
    }
    
    // Delete user account
    await user.delete();
    
    // Clear local storage
    localStorage.clear();
    
    // Show final message and redirect
    alert('Account deleted successfully. You will be redirected to the home page.');
    window.location.href = 'index.html';
    
  } catch (error) {
    console.error('Error deleting account:', error);
    let errorMessage = 'Error deleting account. Please try again.';
    
    if (error.code === 'auth/requires-recent-login') {
      errorMessage = 'Please log out and log back in before deleting your account for security reasons.';
    } else if (error.message) {
      errorMessage = error.message;
    }
    
    showErrorMessage(errorMessage);
  } finally {
    // Reset button state
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

// Toggle Switches Setup
function setupToggleSwitches() {
  document.querySelectorAll('.toggle-switch input').forEach(toggle => {
    const settingItem = toggle.closest('.setting-item');
    const settingTitle = settingItem.querySelector('h4').textContent;
    const settingKey = `edurack_setting_${settingTitle.replace(/\s+/g, '_').toLowerCase()}`;
    
    // Load saved state
    const savedState = localStorage.getItem(settingKey);
    if (savedState !== null) {
      toggle.checked = savedState === 'true';
    }
    
    // Add change listener
    toggle.addEventListener('change', async () => {
      try {
        // Save to localStorage
        localStorage.setItem(settingKey, toggle.checked);
        
        // Save to Firestore
        const settingsUpdate = {};
        settingsUpdate[`settings.${settingKey}`] = toggle.checked;
        settingsUpdate.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
        
        await firestore.collection('users').doc(currentUserData.id).update(settingsUpdate);
        
        showSuccessMessage(`${settingTitle} ${toggle.checked ? 'enabled' : 'disabled'}`);
        
        // Special handling for certain settings
        if (settingTitle.includes('Sound Effects')) {
          handleSoundEffectsToggle(toggle.checked);
        } else if (settingTitle.includes('Animations')) {
          handleAnimationsToggle(toggle.checked);
        }
        
      } catch (error) {
        console.error('Error saving setting:', error);
        // Revert toggle state
        toggle.checked = !toggle.checked;
        showErrorMessage('Error saving setting. Please try again.');
      }
    });
  });
}

// Select Dropdowns Setup
function setupSelectDropdowns() {
  document.querySelectorAll('select').forEach(select => {
    if (select.id && select.id !== 'themeSelect') {
      const settingKey = `edurack_setting_${select.id}`;
      
      // Load saved value
      const savedValue = localStorage.getItem(settingKey);
      if (savedValue) {
        select.value = savedValue;
      }
      
      // Add change listener
      select.addEventListener('change', async () => {
        try {
          // Save to localStorage
          localStorage.setItem(settingKey, select.value);
          
          // Save to Firestore
          const settingsUpdate = {};
          settingsUpdate[`settings.${settingKey}`] = select.value;
          settingsUpdate.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
          
          await firestore.collection('users').doc(currentUserData.id).update(settingsUpdate);
          
          const settingName = select.closest('.setting-item').querySelector('h4').textContent;
          showSuccessMessage(`${settingName} updated to ${select.options[select.selectedIndex].text}`);
          
        } catch (error) {
          console.error('Error saving setting:', error);
          showErrorMessage('Error saving setting. Please try again.');
        }
      });
    }
  });
}

// Load User Settings from Firestore
async function loadUserSettings() {
  try {
    if (!currentUserData.id) return;
    
    const doc = await firestore.collection('users').doc(currentUserData.id).get();
    const userData = doc.data();
    
    if (userData && userData.settings) {
      // Apply saved settings to toggles and selects
      Object.entries(userData.settings).forEach(([key, value]) => {
        if (key.startsWith('edurack_setting_')) {
          localStorage.setItem(key, value);
          
          // Update UI elements
          const toggle = document.querySelector(`input[data-setting="${key}"]`);
          if (toggle) {
            toggle.checked = value === true;
          }
          
          const select = document.querySelector(`select[data-setting="${key}"]`);
          if (select) {
            select.value = value;
          }
        }
      });
    }
  } catch (error) {
    console.error('Error loading user settings:', error);
  }
}

// Special Setting Handlers
function handleSoundEffectsToggle(enabled) {
  if (enabled) {
    // Play a test sound
    playNotificationSound();
  }
  
  // Store globally for use in other parts of the app
  window.edurackSettings = window.edurackSettings || {};
  window.edurackSettings.soundEffects = enabled;
}

function handleAnimationsToggle(enabled) {
  if (enabled) {
    document.body.classList.remove('no-animations');
  } else {
    document.body.classList.add('no-animations');
  }
  
  // Store globally
  window.edurackSettings = window.edurackSettings || {};
  window.edurackSettings.animations = enabled;
}

// Utility Functions
function openModal(modal) {
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  // Focus first input in modal
  const firstInput = modal.querySelector('input');
  if (firstInput) {
    setTimeout(() => firstInput.focus(), 100);
  }
}

function closeModal(modal) {
  modal.classList.remove('active');
  document.body.style.overflow = '';
  
  // Reset forms
  const form = modal.querySelector('form');
  if (form) {
    form.reset();
  }
  
  // Reset delete confirmation
  if (modal === deleteModal) {
    deleteConfirmation.value = '';
    confirmDelete.disabled = true;
    confirmDelete.style.background = '';
    confirmDelete.style.transform = '';
  }
}

function showSuccessMessage(message) {
  const messageEl = successMessage.querySelector('span');
  messageEl.textContent = message;
  successMessage.classList.add('show');
  
  // Auto hide after 3 seconds
  setTimeout(() => {
    successMessage.classList.remove('show');
  }, 3000);
  
  // Play sound if enabled
  if (window.edurackSettings?.soundEffects) {
    playSuccessSound();
  }
}

function showErrorMessage(message) {
  // Create error message element if it doesn't exist
  let errorMessage = document.getElementById('errorMessage');
  if (!errorMessage) {
    errorMessage = document.createElement('div');
    errorMessage.id = 'errorMessage';
    errorMessage.className = 'error-message';
    errorMessage.innerHTML = '<i class="fas fa-exclamation-circle"></i><span></span>';
    errorMessage.style.cssText = `
      background: rgba(244, 67, 54, 0.1);
      border: 1px solid rgba(244, 67, 54, 0.3);
      color: var(--danger-color);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      align-items: center;
      gap: 8px;
      animation: slideDown 0.3s ease;
    `;
    successMessage.parentNode.insertBefore(errorMessage, successMessage.nextSibling);
  }
  
  const messageEl = errorMessage.querySelector('span');
  messageEl.textContent = message;
  errorMessage.style.display = 'flex';
  
  // Auto hide after 5 seconds
  setTimeout(() => {
    errorMessage.style.display = 'none';
  }, 5000);
  
  // Play error sound if enabled
  if (window.edurackSettings?.soundEffects) {
    playErrorSound();
  }
}

function createLoadingOverlay(message) {
  const overlay = document.createElement('div');
  overlay.className = 'loading-overlay';
  overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--modal-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    flex-direction: column;
    gap: 16px;
  `;
  
  overlay.innerHTML = `
    <div style="
      background: var(--white);
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      box-shadow: var(--card-shadow);
    ">
      <div style="
        width: 40px;
        height: 40px;
        border: 4px solid var(--border-color);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
      "></div>
      <p style="color: var(--text-color); font-weight: 500;">${message}</p>
    </div>
  `;
  
  return overlay;
}

// Sound Functions
function playSuccessSound() {
  try {
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
    audio.volume = 0.3;
    audio.play().catch(() => {}); // Ignore errors
  } catch (error) {
    // Ignore audio errors
  }
}

function playErrorSound() {
  try {
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
    audio.volume = 0.2;
    audio.play().catch(() => {}); // Ignore errors
  } catch (error) {
    // Ignore audio errors
  }
}

function playNotificationSound() {
  try {
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
    audio.volume = 0.25;
    audio.play().catch(() => {}); // Ignore errors
  } catch (error) {
    // Ignore audio errors
  }
}

// Logout Function
function handleLogout(e) {
  e.preventDefault();
  
  if (confirm('Are you sure you want to log out?')) {
    auth.signOut()
      .then(() => {
        localStorage.removeItem('edurack_current_settings_section');
        window.location.href = "index.html";
      })
      .catch(error => {
        console.error("Sign out error:", error);
        showErrorMessage('Error signing out. Please try again.');
      });
  }
}

// Add CSS for animations and loading states
const additionalStyles = document.createElement('style');
additionalStyles.textContent = `
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .no-animations * {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }
  
  .error-message {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
    color: var(--danger-color);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: none;
    align-items: center;
    gap: 8px;
    animation: slideDown 0.3s ease;
  }
  
  .error-message.show {
    display: flex;
  }
  
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  .loading-overlay {
    backdrop-filter: blur(4px);
  }
`;
document.head.appendChild(additionalStyles);

// Register Service Worker for PWA capabilities
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js")
      .then(registration => console.log("Service Worker registered with scope:", registration.scope))
      .catch(err => console.error("Service Worker registration failed:", err));
  });
}

// Initialize keyboard shortcuts
document.addEventListener('keydown', (e) => {
  // Ctrl/Cmd + S to save profile
  if ((e.ctrlKey || e.metaKey) && e.key === 's') {
    e.preventDefault();
    if (document.getElementById('profile-section').classList.contains('active')) {
      profileForm.dispatchEvent(new Event('submit'));
    }
  }
  
  // Escape to close modals
  if (e.key === 'Escape') {
    if (passwordModal.classList.contains('active')) {
      closeModal(passwordModal);
    }
    if (deleteModal.classList.contains('active')) {
      closeModal(deleteModal);
    }
  }
});

console.log('🔥 Edurack Settings - All features loaded and ready!');
</script>
</body>
</html>
